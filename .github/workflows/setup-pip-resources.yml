name: Setup PIP and Orientation Resources

on:
  workflow_dispatch:
  push:
    branches:
      - main
      - develop
    paths:
      - '.github/workflows/setup-pip-resources.yml'

jobs:
  setup-resources:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Create drawable directory if not exists
        run: |
          mkdir -p app/src/main/res/drawable
      
      - name: Create utils directory if not exists
        run: |
          mkdir -p app/src/main/java/com/livetvpro/utils
      
      - name: Create screen rotation icon
        run: |
          cat > app/src/main/res/drawable/ic_screen_rotation_24dp.xml << 'EOF'
          <?xml version="1.0" encoding="utf-8"?>
          <!-- ic_screen_rotation_24dp.xml - Free rotation icon -->
          <vector xmlns:android="http://schemas.android.com/apk/res/android"
              android:width="24dp"
              android:height="24dp"
              android:viewportWidth="24"
              android:viewportHeight="24">
              <path
                  android:fillColor="#FFFFFF"
                  android:pathData="M16.48,2.52c3.27,1.55 5.61,4.72 5.97,8.48h1.5C23.44,4.84 18.29,0 12,0l-0.66,0.03 3.81,3.81 1.33,-1.32zM10.23,1.75c-0.59,-0.59 -1.54,-0.59 -2.12,0L1.75,8.11c-0.59,0.59 -0.59,1.54 0,2.12l12.02,12.02c0.59,0.59 1.54,0.59 2.12,0l6.36,-6.36c0.59,-0.59 0.59,-1.54 0,-2.12L10.23,1.75zM14.83,21.19L2.81,9.17l6.36,-6.36 12.02,12.02 -6.36,6.36z"/>
          </vector>
          EOF
      
      - name: Create screen landscape icon
        run: |
          cat > app/src/main/res/drawable/ic_screen_landscape_24dp.xml << 'EOF'
          <?xml version="1.0" encoding="utf-8"?>
          <!-- ic_screen_landscape_24dp.xml - Landscape orientation icon -->
          <vector xmlns:android="http://schemas.android.com/apk/res/android"
              android:width="24dp"
              android:height="24dp"
              android:viewportWidth="24"
              android:viewportHeight="24">
              <path
                  android:fillColor="#FFFFFF"
                  android:pathData="M1.01,7L1,17c0,1.1 0.9,2 2,2h18c1.1,0 2,-0.9 2,-2L23,7c0,-1.1 -0.9,-2 -2,-2L3,5c-1.1,0 -1.99,0.9 -1.99,2zM21,7v10L3,17L3,7h18z"/>
          </vector>
          EOF
      
      - name: Create screen portrait icon
        run: |
          cat > app/src/main/res/drawable/ic_screen_portrait_24dp.xml << 'EOF'
          <?xml version="1.0" encoding="utf-8"?>
          <!-- ic_screen_portrait_24dp.xml - Portrait orientation icon -->
          <vector xmlns:android="http://schemas.android.com/apk/res/android"
              android:width="24dp"
              android:height="24dp"
              android:viewportWidth="24"
              android:viewportHeight="24">
              <path
                  android:fillColor="#FFFFFF"
                  android:pathData="M17,1.01L7,1c-1.1,0 -2,0.9 -2,2v18c0,1.1 0.9,2 2,2h10c1.1,0 2,-0.9 2,-2L19,3c0,-1.1 -0.9,-1.99 -2,-1.99zM17,19L7,19L7,5h10v14z"/>
          </vector>
          EOF
      
      - name: Create screen lock rotation icon
        run: |
          cat > app/src/main/res/drawable/ic_screen_lock_rotation_24dp.xml << 'EOF'
          <?xml version="1.0" encoding="utf-8"?>
          <!-- ic_screen_lock_rotation_24dp.xml - Rotation lock icon -->
          <vector xmlns:android="http://schemas.android.com/apk/res/android"
              android:width="24dp"
              android:height="24dp"
              android:viewportWidth="24"
              android:viewportHeight="24">
              <path
                  android:fillColor="#FFFFFF"
                  android:pathData="M23.25,12.77l-2.57,-2.57 -1.41,1.41 2.22,2.22 -5.66,5.66L4.51,8.17l5.66,-5.66 2.1,2.1 1.41,-1.41L11.23,0.75c-0.59,-0.59 -1.54,-0.59 -2.12,0L2.75,7.11c-0.59,0.59 -0.59,1.54 0,2.12l12.02,12.02c0.59,0.59 1.54,0.59 2.12,0l6.36,-6.36c0.59,-0.58 0.59,-1.53 0,-2.12zM8.47,20.48C5.2,18.94 2.86,15.76 2.5,12L1,12c0.51,6.16 5.66,11 11.95,11l0.66,-0.03 -3.81,-3.82 -1.33,1.33z"/>
          </vector>
          EOF
      
      - name: Create screen lock landscape icon
        run: |
          cat > app/src/main/res/drawable/ic_screen_lock_landscape_24dp.xml << 'EOF'
          <?xml version="1.0" encoding="utf-8"?>
          <!-- ic_screen_lock_landscape_24dp.xml - Lock to landscape icon -->
          <vector xmlns:android="http://schemas.android.com/apk/res/android"
              android:width="24dp"
              android:height="24dp"
              android:viewportWidth="24"
              android:viewportHeight="24">
              <path
                  android:fillColor="#FFFFFF"
                  android:pathData="M21,5L3,5c-1.1,0 -2,0.9 -2,2v10c0,1.1 0.9,2 2,2h18c1.1,0 2,-0.9 2,-2L23,7c0,-1.1 -0.9,-2 -2,-2zM21,17L3,17L3,7h18v10zM10,13h4v-2h-4v2z"/>
          </vector>
          EOF
      
      - name: Create screen lock portrait icon
        run: |
          cat > app/src/main/res/drawable/ic_screen_lock_portrait_24dp.xml << 'EOF'
          <?xml version="1.0" encoding="utf-8"?>
          <!-- ic_screen_lock_portrait_24dp.xml - Lock to portrait icon -->
          <vector xmlns:android="http://schemas.android.com/apk/res/android"
              android:width="24dp"
              android:height="24dp"
              android:viewportWidth="24"
              android:viewportHeight="24">
              <path
                  android:fillColor="#FFFFFF"
                  android:pathData="M10,16h4v-2h-4v2zM17,1L7,1c-1.1,0 -2,0.9 -2,2v18c0,1.1 0.9,2 2,2h10c1.1,0 2,-0.9 2,-2L19,3c0,-1.1 -0.9,-2 -2,-2zM17,19L7,19L7,5h10v14z"/>
          </vector>
          EOF
      
      - name: Create PlayerOrientation enum class
        run: |
          cat > app/src/main/java/com/livetvpro/utils/PlayerOrientation.kt << 'EOF'
          package com.livetvpro.utils

          enum class PlayerOrientation {
              /**
               * Auto-detects orientation from video aspect ratio.
               * Portrait videos â†’ SENSOR_PORTRAIT
               * Landscape videos â†’ SENSOR_LANDSCAPE
               */
              VIDEO,
              
              /**
               * Allows rotation between landscape orientations only.
               * User can rotate between normal landscape and reverse landscape.
               */
              LANDSCAPE,
              
              /**
               * Allows rotation between portrait orientations only.
               * User can rotate between normal portrait and reverse portrait.
               */
              PORTRAIT,
              
              /**
               * Locks to landscape orientation.
               * No rotation allowed - fixed to normal landscape.
               */
              LOCKED_LANDSCAPE,
              
              /**
               * Locks to portrait orientation.
               * No rotation allowed - fixed to normal portrait.
               */
              LOCKED_PORTRAIT,
              
              /**
               * Follows system auto-rotate setting.
               * Allows free rotation if system auto-rotate is enabled.
               */
              SYSTEM
          }
          EOF
      
      - name: Verify files were created
        run: |
          echo "=== Checking drawable files ==="
          ls -lh app/src/main/res/drawable/ic_screen_*.xml
          echo ""
          echo "=== Checking PlayerOrientation.kt ==="
          ls -lh app/src/main/java/com/livetvpro/utils/PlayerOrientation.kt
          echo ""
          echo "âœ… All files created successfully!"
      
      - name: Check if files already exist in git
        id: check_changes
        run: |
          git add app/src/main/res/drawable/ic_screen_*.xml
          git add app/src/main/java/com/livetvpro/utils/PlayerOrientation.kt
          
          if git diff --cached --quiet; then
            echo "has_changes=false" >> $GITHUB_OUTPUT
            echo "No changes detected - files already exist"
          else
            echo "has_changes=true" >> $GITHUB_OUTPUT
            echo "Changes detected - will commit"
          fi
      
      - name: Commit and push changes
        if: steps.check_changes.outputs.has_changes == 'true'
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"
          git commit -m "ðŸŽ¨ Add PIP and orientation resources

          - Add 6 screen rotation drawable icons
          - Add PlayerOrientation enum class
          - Auto-generated by GitHub Actions"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Create summary
        run: |
          echo "## ðŸŽ‰ PIP and Orientation Resources Setup Complete!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### âœ… Files Created:" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Drawable Resources (6 files):**" >> $GITHUB_STEP_SUMMARY
          echo "- \`ic_screen_rotation_24dp.xml\` - Free rotation icon" >> $GITHUB_STEP_SUMMARY
          echo "- \`ic_screen_landscape_24dp.xml\` - Landscape orientation icon" >> $GITHUB_STEP_SUMMARY
          echo "- \`ic_screen_portrait_24dp.xml\` - Portrait orientation icon" >> $GITHUB_STEP_SUMMARY
          echo "- \`ic_screen_lock_rotation_24dp.xml\` - Rotation lock icon" >> $GITHUB_STEP_SUMMARY
          echo "- \`ic_screen_lock_landscape_24dp.xml\` - Lock to landscape icon" >> $GITHUB_STEP_SUMMARY
          echo "- \`ic_screen_lock_portrait_24dp.xml\` - Lock to portrait icon" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Kotlin Files:**" >> $GITHUB_STEP_SUMMARY
          echo "- \`PlayerOrientation.kt\` - Enum class with 6 orientation modes" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“ Locations:" >> $GITHUB_STEP_SUMMARY
          echo "- Drawables: \`app/src/main/res/drawable/\`" >> $GITHUB_STEP_SUMMARY
          echo "- Kotlin: \`app/src/main/java/com/livetvpro/utils/\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸš€ Next Steps:" >> $GITHUB_STEP_SUMMARY
          echo "1. Update your PlayerActivity.kt with the new implementation" >> $GITHUB_STEP_SUMMARY
          echo "2. Add rotation button to your player controller layout" >> $GITHUB_STEP_SUMMARY
          echo "3. Update dimens.xml with subtitle margins" >> $GITHUB_STEP_SUMMARY
          echo "4. Add string resources (rotation, play, pause)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          if [ "${{ steps.check_changes.outputs.has_changes }}" == "true" ]; then
            echo "âœ… Changes were committed and pushed to the repository" >> $GITHUB_STEP_SUMMARY
          else
            echo "â„¹ï¸ No changes - files already exist in the repository" >> $GITHUB_STEP_SUMMARY
          fi
